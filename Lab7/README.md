# Name 1: Frederick Zieber, PID: A12864749
# Name 2: Cole Rindal, PID:A16579270

# Lab 7

## General Outline

For this lab, we learned about how to incorporate the use of a camera with our Raspberry Pi. In the Tutorials, we learn how to take a picture with the camera and how to read text from an image, so that in the Challenge, we can learn how to create a restful server that reads the liscence plate in an image and returns it as text, and saves the output shown on screen to a database.

## Tutorial 1: 

In this Tutorial, we learned how to use the camera with the Raspberry pi. We installed the necessary software, ran the five lines of code, and took a picture with the camera as a result.



## Tutorial 2:

In this Tutorial, we learned how to use image processing and tesseract to read the text in an image. The specific goal for this tutorial was to take a picture of a sudoku puzzle and return the solved output as a 2d array. First we resized and reshaaped the image so that the sudoku puzzle, no matter the angle, became an evenly distributed 900x900 image, then we used tesseract to read each square in the resized image into a 2d array, then we solved the puzzle. 

## Challenge:

For the Midterm, we decided to use the ultrasonic ranging module and the DHT-11 hygrothermograph as our two inputs to store four elements to a table in our MYSQL database: id, temperature, humidity, and distance. id is uniquely designated by the "cycle from start". We then use a Restful route to collect data from the table as a JSON and display the values based the query criteria. Said criteria consists of a valid temperature reading (>-100 degrees), and the two input criteria of time (cycles from start) and distance, both of which ask for an input min and an input max value to construct the ranges for the query. Finally, there is a warning button so that if pushed, a variable is toggled, so that the next submit button push will result in either the buzzer and LED will turn on or off, depending on the newly set variable.

For a demo, follow the following link:

[Challenge Video Demo!](https://m.youtube.com/watch?v=SGZRxeeTkvE)


### How to use:

For our code to run, be sure to create the database Midterm\_db and grant relevant privileges, as well as overwrite credentials.env with appropriate credentials. After this is done, open two terminals on your computer (not the Raspberry) and ssh into the Raspberry. Next run init-db.py in one terminal to initialize the table, then run sensor.py to collect data. While its running, or after you stop it, use the other terminal (or same one if sensor was stopped) and run app.py from here. Now, the site is running on localhost:6543 on the Raspberry! Use a means of accessing the Raspberry's desktop (such as VNC Viewer), pull up localhost:6543, and the site should load. From here, change the input ranges to how you prefer, hit Submit, and a table of relevant data, or ean empty table will load on screen. If you wish to "alert the hardware operator" (activate the buzzer) press
the Warning button and hit submit. Repeat this process to turn off the buzzer.


### File Descriptions:

Our approach consists of the following in each file:


credentials.env: Stores Environment Variables for the credentials needed to access MySql. _Warning! Replace with valid credentials for your device as needed!_


init-db.py: This python file connects to MySql using credentials.env, creates the database Plate\_db if it does not already exist, and tells MySql to use said database. It then deletes any existing Data\_Table table, and creates a new table of the same name that contains columns for image name, timestamp, and image text.


index.html: HTML file used to generate the webpage. Consists of a title and header, an integer input, a display button, and a set location for the resulting image and text to be displayed. The display button calls a function from rest.js, updating the webpage accordingly.


rest.js: Javascript file consisting of the function click\_display\(\), which reads the input value for the image id, creates a URL using the input, fetches the URL for the json response containing the relevant data, then the response is displayed in the appropriate section of the site. 


detector.py: This python file first loads the credentials needed for MySql, then creates two route-view pairs, a static view, configures the app, and sends the information to local host 6543. The first route-view pair creates a home route generated by index.html. The second pair handles the URLs generated in rest.js as route "photos", and generates the view based on index.html with the changes made by click\_display\(\) in rest.js using the response from get\_photo\(req\). get\_photo\(req\) takes the input integer, saves the img\_src for the given id, calls detect\_plate\(img\) on the imd\_src, calls get\_text\(img\) on the resulting cropped image, and returns a json consisting of the img_src for the img and the text from the image for use in rest.js. _Warning! Use localhost:6543 if 0.0.0.0:6543 causes issues!_











